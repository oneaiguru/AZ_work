<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>GraphQL Console</title>
    <style>
      :root {
        color-scheme: light dark;
        font-family: 'Segoe UI', 'Roboto', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        --bg: #0e1117;
        --panel: #161b22;
        --text: #e6edf3;
        --accent: #409cff;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        background: var(--bg);
        color: var(--text);
        display: flex;
        flex-direction: column;
      }

      header {
        padding: 1.25rem clamp(1rem, 3vw, 2.5rem);
        background: linear-gradient(120deg, #111927, #020611);
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.35);
      }

      header h1 {
        margin: 0 0 0.35rem;
        font-size: clamp(1.25rem, 4vw, 1.75rem);
      }

      header p {
        margin: 0;
        opacity: 0.75;
        font-size: 0.95rem;
      }

      main {
        flex: 1;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1rem;
        padding: 1rem clamp(1rem, 3vw, 2.5rem) 2rem;
      }

      section {
        background: var(--panel);
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        min-height: 260px;
      }

      section h2 {
        margin: 0;
        padding: 0.85rem 1rem;
        font-size: 0.95rem;
        letter-spacing: 0.02em;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }

      textarea {
        flex: 1;
        width: 100%;
        background: transparent;
        border: none;
        resize: none;
        padding: 1rem;
        color: inherit;
        font-family: 'Fira Code', 'SFMono-Regular', Consolas, monospace;
        font-size: 0.95rem;
        line-height: 1.45;
      }

      textarea:focus {
        outline: none;
        box-shadow: inset 0 0 0 2px rgba(64, 156, 255, 0.35);
      }

      button {
        background: var(--accent);
        border: none;
        color: #fff;
        font-size: 1rem;
        font-weight: 600;
        padding: 0.85rem 1.5rem;
        border-radius: 999px;
        cursor: pointer;
        transition: transform 150ms ease, box-shadow 150ms ease;
        align-self: start;
        margin-top: 0.5rem;
      }

      button:hover {
        box-shadow: 0 4px 15px rgba(64, 156, 255, 0.45);
        transform: translateY(-1px);
      }

      button:disabled {
        opacity: 0.4;
        cursor: wait;
        transform: none;
        box-shadow: none;
      }

      pre {
        flex: 1;
        margin: 0;
        padding: 1rem;
        font-family: 'Fira Code', 'SFMono-Regular', Consolas, monospace;
        font-size: 0.9rem;
        overflow: auto;
        white-space: pre-wrap;
        word-break: break-word;
      }

      .actions {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        align-items: center;
        padding: 0 1rem 1rem;
      }

      .actions small {
        opacity: 0.75;
      }

      @media (max-width: 640px) {
        header p {
          font-size: 0.85rem;
        }

        textarea,
        pre {
          font-size: 0.85rem;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>GraphQL Console</h1>
      <p>Send queries directly to <code>/graphql</code> without waiting for external scripts.</p>
    </header>

    <main>
      <section>
        <h2>Query</h2>
        <textarea id="query" spellcheck="false"></textarea>
        <div class="actions">
          <button id="execute">Run query</button>
          <button id="reset" type="button">Reset</button>
          <small id="status">Idle</small>
        </div>
      </section>
      <section>
        <h2>Result</h2>
        <pre id="result">Hit "Run query" to execute the sample request.</pre>
      </section>
    </main>

    <script>
      const storageKey = 'graphql-console-query';
      const sample = `# Sample query\n# Replace with your own request\nquery Books {\n  books {\n    id\n    title\n    author\n  }\n}`;

      const queryEl = document.getElementById('query');
      const resultEl = document.getElementById('result');
      const statusEl = document.getElementById('status');
      const runBtn = document.getElementById('execute');
      const resetBtn = document.getElementById('reset');

      function setStatus(text) {
        statusEl.textContent = text;
      }

      function setResult(content) {
        resultEl.textContent = content;
      }

      const saved = window.localStorage.getItem(storageKey);
      queryEl.value = saved || sample;

      resetBtn.addEventListener('click', () => {
        queryEl.value = sample;
        setResult('Hit "Run query" to execute the sample request.');
        window.localStorage.removeItem(storageKey);
      });

      async function executeQuery() {
        const query = queryEl.value.trim();
        if (!query) {
          setResult('Please enter a GraphQL query.');
          return;
        }

        window.localStorage.setItem(storageKey, query);
        runBtn.disabled = true;
        setStatus('Sending…');
        setResult('Awaiting response…');

        try {
          const response = await fetch('/graphql', {
            method: 'POST',
            headers: {
              'content-type': 'application/json',
            },
            body: JSON.stringify({ query }),
          });

          const text = await response.text();
          try {
            const json = JSON.parse(text);
            setResult(JSON.stringify(json, null, 2));
          } catch (parseError) {
            setResult(text);
          }
          setStatus(response.ok ? 'Success' : `HTTP ${response.status}`);
        } catch (error) {
          setResult(String(error));
          setStatus('Network error');
        } finally {
          runBtn.disabled = false;
        }
      }

      runBtn.addEventListener('click', () => {
        executeQuery();
      });

      queryEl.addEventListener('keydown', (event) => {
        if ((event.metaKey || event.ctrlKey) && event.key === 'Enter') {
          event.preventDefault();
          executeQuery();
        }
      });
    </script>
  </body>
</html>
