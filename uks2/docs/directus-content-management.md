# Инструкция по управлению контентом в Directus

Документ предназначен для редакторов и администраторов сайта УКС Иркутска, использующих Directus 11 в составе стека `uks2/`. Руководство описывает полный цикл работы с материалами: от входа в систему до проверки публикаций на сайте.

## Содержание

1. [Доступ и роли](#1-доступ-и-роли)
2. [Медиатека](#2-медиатека)
3. [Публикация новостей и заметок](#3-публикация-новостей-и-заметок)
4. [Проекты и галереи](#4-проекты-и-галереи)
5. [Закупки и коммерческие помещения](#5-закупки-и-коммерческие-помещения)
6. [Документы и реквизиты](#6-документы-и-реквизиты)
7. [Настройки главной страницы](#7-настройки-главной-страницы)
8. [Проверка и публикация](#8-проверка-и-публикация)
9. [Версионность и откат](#9-версионность-и-откат)
10. [Резервное копирование](#10-резервное-копирование)
11. [Устранение неполадок](#11-устранение-неполадок)
12. [Контроль качества перед публикацией](#12-контроль-качества-перед-публикацией)

## 1. Доступ и роли

1. Откройте браузер и перейдите по адресу, указанному в переменной `DIRECTUS_PUBLIC_URL` (по умолчанию `https://cms.uks2.localhost/admin`).
2. Авторизуйтесь с помощью учётных данных администратора (`DIRECTUS_ADMIN_EMAIL` и `DIRECTUS_ADMIN_PASSWORD`).
3. Чтобы добавить новых сотрудников, перейдите в **Настройки → Пользователи**, создайте запись и назначьте роль:
   - **admin** — полный доступ ко всем настройкам и коллекциям;
   - **editor** — редактирование контента без изменения системных параметров;
   - **manager_procurement** — управление закупками и коммерческими помещениями;
   - **viewer** — просмотр без права редактирования.
4. При необходимости подключите двухфакторную аутентификацию (2FA) в профиле пользователя.

## 2. Медиатека

1. Перейдите в раздел **Файлы**.
2. Нажмите **Загрузить** и добавьте изображения или документы. Directus сохранит их в бакете MinIO, настроенном в разделе **Настройки → Хранилища**.
3. Для каждого файла заполните **Название**, **Описание** и **Alt-текст** — эти поля используются на сайте и влияют на SEO.
4. Создавайте папки для логической группировки (например, `news`, `projects`, `documents`).
5. При замене файла используйте действие **Новая версия**, чтобы сохранить историю изменений.

## 3. Публикация новостей и заметок

1. Откройте коллекцию **news_articles**.
2. Нажмите **Создать элемент** и заполните поля:
   - **title** — заголовок публикации;
   - **excerpt** — краткий текст анонса (используется в карточке на сайте);
   - **published_at** — дата и время публикации;
   - **sort** — необязательный числовой приоритет (меньшее значение поднимет запись выше).
3. Для иллюстрации загрузите изображение в **Файлы**, откройте карточку файла и скопируйте публичную ссылку или идентификатор. Эту ссылку можно добавить в текст анонса (например, как Markdown `![](URL)`), либо передать команде разработки для отображения баннера в отдельном блоке.
4. Сохраните запись. На фронтенде новость появится в блоке «Анонсы и события» на главной странице и в списке закупок (в соответствии с настройками фронтенда).

## 4. Проекты и галереи

1. Перейдите в **projects** и откройте существующий проект или создайте новый.
2. Заполните основные поля:
   - **title** — название объекта;
   - **slug** — машинное имя для ссылок (латиницей, без пробелов);
   - **category** — тип проекта (жилой фонд, социальный объект и т. п.);
   - **year** — ключевой год реализации (для сортировки);
   - **description** — расширенное описание проекта;
   - **sort** — необязательный приоритет для ручного упорядочивания.
3. Иллюстрации проекта храните в разделе **Файлы**. Добавьте подписи к изображениям и вставьте ссылки на них в поле описания либо передайте адреса команде верстки для подключения к карточке проекта.
4. При необходимости добавьте связанный нормативный документ в коллекции [Документы](#6-документы-и-реквизиты) — на фронтенде в таблице можно сослаться на URL документа.
5. После сохранения проверьте отображение проекта на страницах `/projects` и `/projects/[slug]`.

## 5. Закупки и коммерческие помещения

1. Откройте коллекцию **procurements**.
2. Заполните поля:
   - **title** — название процедуры;
   - **slug** — короткий идентификатор (для URL `/zakupki/<slug>`);
   - **status** — `draft`, `moderated`, `published` или `archived`;
   - **shortDescription** — краткое описание для карточки;
   - **procurementType** — тип (`commercial`, `contract`, `service` и т. д.);
   - **startDate** / **endDate** — период приёма заявок;
   - **sort** — вручную задаёт порядок сортировки (по умолчанию 0).
3. Документы и внешние ссылки пока не вынесены в отдельные поля. Если требуется приложить положение, добавьте ссылку на файл в тексте описания либо разместите документ в коллекции **documents** и укажите URL.
4. Для коммерческих помещений используйте тип `commercial` и опишите ключевые параметры (площадь, стоимость, адрес) в тексте описания.
5. После публикации проверьте карточку в разделах «Актуальные процедуры», «Архив» и «План закупок».

## 6. Документы и реквизиты

1. Коллекция **documents** содержит нормативные акты, реквизиты и иные вложения.
2. Заполните поля:
   - **title** — название документа;
   - **category** — тип (уставные документы, закупки, реквизиты и т. п.);
   - **url** — ссылка на файл в MinIO или внешнем хранилище;
   - **documentDate** — дата публикации/подписания;
   - **sort** — порядок сортировки в таблице.
3. После сохранения ссылка появится в разделе `/documents`. Если документ приватный, разместите его в защищённом бакете MinIO и предоставьте доступ вручную.
4. Реквизиты организации находятся в синглтоне **contacts** (адрес, телефоны, расписание) и в блоке `about_values` коллекции **homepage**.

## 7. Настройки главной страницы

1. В коллекции **homepage** хранится структура лендинга: геро-блок, счётчики, списки преимуществ, ссылки на документы и т. д.
2. Редактируйте текстовые блоки и изображения, сохраняйте изменения и проверяйте результат на сайте.
3. Для JSON-полей используйте режим «Редактор кода», чтобы избежать ошибок в структуре.

## 8. Проверка и публикация

1. После сохранения откройте сайт (`https://uks2.localhost` или боевой домен) и убедитесь, что изменения отображаются корректно.
2. Если правки не появились, очистите кеш Directus: **Настройки → Система → Очистить кеш**.
3. Для визуального контроля используйте кнопки **Просмотр** (если настроены Flows) или ссылку на внешний сайт.

## 9. Версионность и откат

1. Directus автоматически сохраняет ревизии. В карточке записи нажмите **История**, чтобы просмотреть предыдущие версии.
2. Выберите нужную ревизию и нажмите **Восстановить** для отката.
3. Для массовых изменений делайте снапшоты структуры: `npx directus schema snapshot snapshot.yaml --yes`.

## 10. Резервное копирование

- **База данных**: используйте `pg_dump` или встроенные бэкапы хостинга.
- **Файлы**: регулярно синхронизируйте бакеты MinIO командой `mc mirror`.
- **Настройки Directus**: храните `snapshot.yaml`, экспорт ролей и пользователей в системе контроля версий.

## 11. Устранение неполадок

| Симптом | Возможная причина | Решение |
| --- | --- | --- |
| Ошибка 400 на `/auth/login` или `/auth/refresh` | Домен в cookie не совпадает с адресной строкой | Проверьте `DIRECTUS_PUBLIC_URL` и `DIRECTUS_COOKIE_DOMAIN`; перезапустите Directus |
| Файлы не загружаются | Неверные учётные данные MinIO или превышен размер файла | Проверьте `MINIO_*` переменные в `.env`, обновите политики доступа |
| Запись не отображается на сайте | Статус `draft` или дата публикации стоит в будущем | Установите статус `published`, проверьте значение `published_at` и обновите страницу |
| Ошибка доступа у редактора | Роль не имеет нужных прав | В **Настройки → Роли и разрешения** добавьте права на коллекцию |

## 12. Контроль качества перед публикацией

1. Проверьте корректность орфографии и форматирование текста в WYSIWYG/Markdown.
2. Убедитесь, что изображения оптимизированы (WebP, размер до 2 МБ) и заданы alt-тексты.
3. Сверьте контактные данные и сроки закупок с официальными документами.
4. Просмотрите страницу в мобильной и десктопной вёрстке (функции предварительного просмотра в браузере).

Следуя этому руководству, редакторы смогут оперативно обновлять материалы сайта и поддерживать их актуальность без привлечения разработчиков.
